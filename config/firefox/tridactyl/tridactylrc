" -*- mode: vimrc -*-

" https://github.com/tridactyl/tridactyl/blob/master/.tridactylrc
" May require the latest beta builds.

"
" Binds
"

" Comment toggler for Reddit, Hacker News and Lobste.rs
bind ;c hint -Jc [class*="expand"],[class="togg"],[class="comment_folder"]

" Git{Hub,Lab} git clone via SSH yank
bind yg composite js "git clone " + document.location.href.replace(/https?:\/\//,"git@").replace("/",":").replace(/$/,".git") | clipboard yank

" make d take you to the left (I find it much less confusing)
bind d composite tabprev; tabclose #
bind D tabclose

" make t open the selection with tabopen
bind --mode=visual t composite js document.getSelection().toString() | fillcmdline tabopen

" I like wikiwand but I don't like the way it changes URLs
bindurl wikiwand.com yy composite js document.location.href.replace("wikiwand.com/en","wikipedia.org/wiki") | clipboard yank

" Make gu take you back to subreddit from comments
bindurl reddit.com gu urlparent 4

" Only hint search results on Google and DDG
bindurl www.google.com f hint -Jc #search div:not(.action-menu) > a
bindurl www.google.com F hint -Jbc #search div:not(.action-menu) > a
" DDG binds are broken as of May 2021
" bindurl ^https://duckduckgo.com f hint -Jc [class=result__a]
" bindurl ^https://duckduckgo.com F hint -Jbc [class=result__a]

" Allow Ctrl-a to select all in the commandline
unbind --mode=ex <C-a>

" Allow Ctrl-c to copy in the commandline
unbind --mode=ex <C-c>

" Handy multiwindow/multitasking binds
bind gd tabdetach
bind gD composite tabduplicate; tabdetach

" Stupid workaround to let hint -; be used with composite which steals semi-colons
command hint_focus hint -;

" Open right click menu on links
" TODO: does this work on macOS?
" bind ;C composite hint_focus; !s xdotool key Menu

" Suspend / "discard" all tabs - handy for stretching out battery life
command discardall jsb browser.tabs.query({}).then(ts => browser.tabs.discard(ts.map(t=>t.id)))

"
" Misc settings
"

" set editorcmd to suckless terminal, or use the defaults on other platforms
js tri.browserBg.runtime.getPlatformInfo().then(os=>{const editorcmd = os.os=="linux" ? "st vim" : "auto"; tri.config.set("editorcmd", editorcmd)})

" Hinting mode
set hintfiltermode vimperator-reflow
set hintnames short
" set hintnames numeric

" Defaults to 300ms
set hintdelay 100

" Make quickmarks for the sane Tridactyl issue view
" TODO: read up on `quickmark`
" quickmark t https://github.com/tridactyl/tridactyl/issues?utf8=%E2%9C%93&q=sort%3Aupdated-desc+


"
" URL redirects
"

" New reddit is bad
" TODO: is this made obsolete by the Privacy Redirect addon?
" autocmd DocStart ^http(s?)://www.reddit.com js tri.excmds.urlmodify("-t", "www", "old")
" Mosquito nets won't make themselves
autocmd DocStart ^http(s?)://www.amazon.co.uk js tri.excmds.urlmodify("-t", "www", "smile")

" Isolate Facebook in its own container
" set auconcreatecontainer true
" autocontain facebook\.com facebook

" Load my preferred color scheme.
colors base16-grayscale-dark
